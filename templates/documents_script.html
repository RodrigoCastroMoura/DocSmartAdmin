let currentPage = 1;
const perPage = 10;
let totalPages = 1;

function getFileIcon(filename) {
    if (!filename) return 'file';
    
    const ext = filename.split('.').pop().toLowerCase();
    switch (ext) {
        case 'pdf': return 'file-text';
        case 'doc': case 'docx': return 'file-text';  // Changed from 'file-word'
        case 'xls': case 'xlsx': return 'file';
        case 'ppt': case 'pptx': return 'file';
        case 'txt': return 'file-text';
        case 'jpg': case 'jpeg': case 'png': case 'gif': case 'bmp': return 'image';
        case 'zip': case 'rar': case '7z': case 'tar': case 'gz': return 'archive';
        case 'mp3': case 'wav': case 'ogg': return 'music';
        case 'mp4': case 'avi': case 'mov': return 'video';
        default: return 'file';
    }
}

function updatePaginationControls() {
    document.getElementById('prevPage').disabled = currentPage <= 1;
    document.getElementById('nextPage').disabled = currentPage >= totalPages;
    document.getElementById('pageInfo').textContent = `Page ${currentPage} of ${totalPages}`;
}

function changePage(newPage) {
    if (newPage >= 1 && newPage <= totalPages) {
        loadDocuments(newPage);
    }
}

function updateDocumentsGrid(data) {
    const documents = data.documents || [];
    const gridHTML = documents.length === 0 ? `
        <div class="documents-grid">
            <div class="no-data">
                <i data-feather="inbox"></i>
                <p>No documents found</p>
            </div>
        </div>` : `
        <div class="documents-grid">
            ${documents.map(doc => `
                <div class="document-card" data-id="${doc.id}">
                    <div class="document-header">
                        <i data-feather="${getFileIcon(doc.name)}"></i>
                        <div class="document-title">
                            <h3>${doc.document_type_name || 'No Type'}</h3>
                            <span class="document-filename">${doc.name}</span>
                        </div>
                    </div>
                    <div class="document-info">
                        <div class="document-user">
                            <div class="user-avatar">${doc.user_name ? doc.user_name.slice(0, 2).toUpperCase() : 'NA'}</div>
                            <div class="user-info">
                                <span class="user-name">${doc.user_name || 'No User'}</span>
                                <span class="user-cpf">${doc.user_cpf || 'No CPF'}</span>
                            </div>
                        </div>
                        <div class="document-meta">
                            <span><i data-feather="eye"></i> ${doc.view_count}</span>
                            <span><i data-feather="download"></i> ${doc.download_count}</span>
                            <span class="document-date">Created: ${new Date(doc.created_at).toLocaleDateString()}</span>
                        </div>
                    </div>
                    <div class="document-actions">
                        <button class="action-btn" onclick="previewDocument('${doc.id}', '${doc.url}')">
                            <i data-feather="eye"></i>
                        </button>
                        <button class="action-btn" onclick="downloadDocument('${doc.id}', '${doc.url}')">
                            <i data-feather="download"></i>
                        </button>
                        <button class="action-btn danger" onclick="deleteDocument('${doc.id}')">
                            <i data-feather="trash-2"></i>
                        </button>
                    </div>
                </div>
            `).join('')}
        </div>`;

    const contentDiv = document.getElementById('documentsContent');
    const paginationControls = contentDiv.querySelector('.pagination-controls');
    contentDiv.innerHTML = gridHTML;
    contentDiv.appendChild(paginationControls);
    feather.replace();
}

// Load functions from before (loadFilterData, handleFilterChange, clearFilters, etc.)
// They remain the same...

// Initialize documents list and filters when page loads
document.addEventListener('DOMContentLoaded', () => {
    loadDocuments();
    loadFilterData();
});
