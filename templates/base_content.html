<div class="dashboard-container">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <img src="{{ url_for('static', filename='img/logo.svg') }}" alt="Logo" class="logo">
            <button id="sidebar-toggle" class="sidebar-toggle">
                <i data-feather="menu"></i>
            </button>
        </div>
        <nav class="sidebar-nav">
            <a href="{{ url_for('dashboard') }}" class="nav-item {% if request.endpoint == 'dashboard' %}active{% endif %}">
                <i data-feather="home"></i>
                <span>Dashboard</span>
            </a>
            <a href="{{ url_for('departments') }}" class="nav-item {% if request.endpoint == 'departments' %}active{% endif %}">
                <i data-feather="briefcase"></i>
                <span>Departments</span>
            </a>
            <a href="{{ url_for('categories') }}" class="nav-item {% if request.endpoint == 'categories' %}active{% endif %}">
                <i data-feather="grid"></i>
                <span>Categories</span>
            </a>
            <a href="{{ url_for('documents') }}" class="nav-item {% if request.endpoint == 'documents' %}active{% endif %}">
                <i data-feather="file-text"></i>
                <span>Documents</span>
            </a>
            <a href="{{ url_for('document_types') }}" class="nav-item {% if request.endpoint == 'document_types' %}active{% endif %}">
                <i data-feather="file"></i>
                <span>Document Types</span>
            </a>
            <a href="{{ url_for('users') }}" class="nav-item {% if request.endpoint == 'users' %}active{% endif %}">
                <i data-feather="users"></i>
                <span>Users</span>
            </a>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <header class="top-bar">
            <div class="search-bar">
                <i data-feather="search"></i>
                <input type="text" placeholder="Search...">
            </div>
            <div class="user-menu">
                <button class="notifications">
                    <i data-feather="bell"></i>
                </button>
                <button class="theme-toggle" onclick="toggleTheme()" title="Alternar tema">
                    <i data-feather="sun" id="themeIcon"></i>
                </button>
                <div class="user-profile" onclick="toggleDropdown()">
                    <span>{{ session.get('user', {}).get('name', 'Admin User') }}</span>
                    <i data-feather="user"></i>
                    <div class="dropdown-menu">
                        <a href="{{ url_for('logout') }}" class="dropdown-item">
                            <i data-feather="log-out"></i>
                            <span>Logout</span>
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <div class="content">
            {% block content %}{% endblock %}
        </div>
    </main>
</div>

<!-- Common Modals -->
<div id="notificationModal" class="modal">
    <div class="modal-content notification-modal">
        <div class="notification-header">
            <i data-feather="info" id="notificationIcon"></i>
            <h3 id="notificationTitle">Notification</h3>
            <button class="close-btn" onclick="hideNotificationModal()">
                <i data-feather="x"></i>
            </button>
        </div>
        <div class="notification-body">
            <p id="notificationMessage"></p>
        </div>
        <div class="notification-actions">
            <button class="action-btn" onclick="hideNotificationModal()">Close</button>
        </div>
    </div>
</div>

<div id="deleteConfirmModal" class="modal">
    <div class="modal-content notification-modal">
        <div class="notification-header">
            <i data-feather="alert-triangle" style="color: var(--danger-color);"></i>
            <h3>Confirm Delete</h3>
            <button class="close-btn" onclick="hideModal('deleteConfirmModal')">
                <i data-feather="x"></i>
            </button>
        </div>
        <div class="notification-body">
            <p>Are you sure you want to delete this item?</p>
            <p>This action cannot be undone.</p>
        </div>
        <div class="notification-actions">
            <button class="action-btn" onclick="hideModal('deleteConfirmModal')">Cancel</button>
            <button class="action-btn danger" onclick="confirmDelete()">Delete</button>
        </div>
    </div>
</div>

<div id="customPopup" class="custom-popup">
    <div class="custom-popup-content">
        <h2 class="custom-popup-title">Ação em Progresso</h2>
        <p class="custom-popup-text">Por favor, aguarde enquanto processamos sua solicitação.</p>
        <div class="loader"></div>
    </div>
</div>

<script>
    // Initialize Feather icons
    feather.replace();

    function toggleDropdown() {
        const dropdown = document.querySelector('.dropdown-menu');
        dropdown.classList.toggle('show');

        // Close dropdown when clicking outside
        document.addEventListener('click', function closeDropdown(e) {
            if (!e.target.closest('.user-profile')) {
                dropdown.classList.remove('show');
                document.removeEventListener('click', closeDropdown);
            }
        });
    }

    function showNotification(message, type = 'error') {
        const modal = document.getElementById('notificationModal');
        const header = modal.querySelector('.notification-header');
        const icon = document.getElementById('notificationIcon');
        const title = document.getElementById('notificationTitle');
        const messageEl = document.getElementById('notificationMessage');

        header.classList.remove('success', 'error');
        
        if (type === 'success') {
            header.classList.add('success');
            title.textContent = 'Success';
            icon.setAttribute('data-feather', 'check-circle');
        } else {
            header.classList.add('error');
            title.textContent = 'Error';
            icon.setAttribute('data-feather', 'alert-circle');
        }

        messageEl.textContent = message;
        modal.style.display = 'block';
        feather.replace();
    }

    function hideNotificationModal() {
        document.getElementById('notificationModal').style.display = 'none';
    }

    function hideModal(modalId) {
        document.getElementById(modalId).style.display = 'none';
    }

    function showModal(modalId) {
        document.getElementById(modalId).style.display = 'block';
    }
</script>
