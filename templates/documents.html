{% extends "base.html" %}

{% block content %}
<!-- Previous content remains the same until the script section -->

<script src="{{ url_for('static', filename='js/validation.js') }}"></script>
<script>
// Setup form validation
setupFormValidation('addDocumentForm', {
    'documentName': [
        ValidationRules.required,
        ValidationRules.minLength(3),
        ValidationRules.maxLength(100)
    ],
    'documentFile': [
        ValidationRules.required
    ]
});

setupFormValidation('editDocumentForm', {
    'editDocumentName': [
        ValidationRules.required,
        ValidationRules.minLength(3),
        ValidationRules.maxLength(100)
    ]
});

// Existing functions remain the same
// Show/Hide Modals
function showModal(modalId) {
    document.getElementById(modalId).style.display = 'block';
    if (modalId === 'addDocumentModal' || modalId === 'editDocumentModal') {
        fetchDepartmentsAndCategories();
    }
}

function hideModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
}

function showAddDocumentModal() {
    document.getElementById('addDocumentForm').reset();
    showModal('addDocumentModal');
}

function showEditDocumentModal(id, document) {
    document.getElementById('editDocumentId').value = id;
    document.getElementById('editDocumentName').value = document.name;
    document.getElementById('editDocumentDepartment').value = document.department_id;
    document.getElementById('editDocumentCategory').value = document.category_id;
    showModal('editDocumentModal');
}

// CRUD Operations with validation
async function createDocument(event) {
    event.preventDefault();
    const form = event.target;
    
    if (!validateForm(form)) {
        return;
    }
    
    const formData = new FormData(form);

    try {
        const response = await fetch('/api/documents', {
            method: 'POST',
            body: formData
        });

        if (response.ok) {
            hideModal('addDocumentModal');
            window.location.reload();
        } else {
            const data = await response.json();
            alert(data.error || 'Failed to create document');
        }
    } catch (error) {
        alert('Failed to create document');
    }
}

async function updateDocument(event) {
    event.preventDefault();
    const form = event.target;
    
    if (!validateForm(form)) {
        return;
    }
    
    const id = document.getElementById('editDocumentId').value;
    const formData = new FormData(form);

    try {
        const response = await fetch(`/api/documents/${id}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(Object.fromEntries(formData))
        });

        if (response.ok) {
            hideModal('editDocumentModal');
            window.location.reload();
        } else {
            const data = await response.json();
            alert(data.error || 'Failed to update document');
        }
    } catch (error) {
        alert('Failed to update document');
    }
}

// Rest of the existing code remains the same
</script>
{% endblock %}
