{% extends "base.html" %}

{% block content %}
[Previous content remains the same until line 131]

async function loadFilterOptions() {
    try {
        const responses = await Promise.allSettled([
            fetch('/api/departments'),
            fetch('/api/categories'),
            fetch('/api/document_types'),
            fetch('/api/users')
        ]);
        
        const results = await Promise.all(
            responses.map(async (response, index) => {
                if (response.status === 'rejected') {
                    console.error(`Error loading filter option ${index}:`, response.reason);
                    return { value: [] };
                }
                if (!response.value.ok) {
                    throw new Error(`HTTP error! status: ${response.value.status}`);
                }
                return response.value.json();
            })
        );
        
        const [departments, categories, types, users] = results;
        
        if (Array.isArray(departments)) {
            populateFilterSelect('filterDepartment', departments);
        } else if (departments.departments) {
            populateFilterSelect('filterDepartment', departments.departments);
        }
        
        if (categories && categories.categories) {
            populateFilterSelect('filterCategory', categories.categories);
        }
        
        if (types && types.document_types) {
            populateFilterSelect('filterDocumentType', types.document_types);
        }
        
        if (users && users.users) {
            populateFilterSelect('filterUser', users.users);
        }
    } catch (error) {
        console.error('Error loading filter options:', error);
        showErrorMessage('Failed to load some filter options. Please try refreshing the page.');
    }
}

[Rest of the file remains the same]
